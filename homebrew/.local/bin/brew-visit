#!/usr/bin/env bash

# Script: brew-visit
# Description: Extract and open the first URL from brew info output

show_help() {
    echo "$(basename "$0") - Extract and open the first URL from brew info output"
    echo ""
    echo "Usage: $(basename "$0") [OPTIONS] <package-name>"
    echo ""
    echo "OPTIONS:"
    echo "  -h, --help    Show this help message and exit"
    echo ""
    echo "ARGUMENTS:"
    echo "  package-name  The name of the Homebrew package to get info for"
    echo ""
    echo "EXAMPLES:"
    echo "  $(basename "$0") git"
    echo "  $(basename "$0") node"
    echo "  $(basename "$0") python"
    echo ""
    echo "DESCRIPTION:"
    echo "  This script runs 'brew info <package-name>', extracts the first URL"
    echo "  found in the output, and opens it in your default web browser."
}

if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
    show_help
    exit 0
fi

if [ $# -eq 0 ]; then
    echo "Usage: $(basename "$0") <package-name>"
    echo "Example: $(basename "$0") git"
    echo ""
    echo "Use -h or --help for more information"
    exit 1
fi

PACKAGE_NAME="$1"

if ! command -v brew &> /dev/null; then
    echo "Error: Homebrew is not installed or not in PATH"
    exit 1
fi

if ! brew_info=$(brew info "$PACKAGE_NAME" 2>&1); then
    echo "Error: Package '$PACKAGE_NAME' not found or brew info failed"
    echo "$brew_info"
    exit 1
fi

FIRST_URL=$(echo "$brew_info" | grep -oE 'https?://[^[:space:]]+' | head -n 1)

if [ -z "$FIRST_URL" ]; then
    echo "No URL found in brew info output for package '$PACKAGE_NAME'"
    exit 1
fi

echo "Found URL: $FIRST_URL"
echo "Opening URL in default browser..."

if command -v open &> /dev/null; then
    # macOS
    open "$FIRST_URL"
elif command -v xdg-open &> /dev/null; then
    # Linux
    xdg-open "$FIRST_URL"
elif command -v wslview &> /dev/null; then
    # WSL (Windows Subsystem for Linux)
    wslview "$FIRST_URL"
else
    echo "Could not determine how to open URLs on this system"
    echo "Please manually visit: $FIRST_URL"
    exit 1
fi

echo "URL opened successfully!"
